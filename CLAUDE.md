# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a simple Python project that tracks YouTube video view counts for the DjangoConUS channel. The project:
- Uses `yt-dlp` to fetch video metadata from the DjangoConUS YouTube channel
- Stores view counts, titles, and URLs in a SQLite database (`views.db`)
- Publishes the data via `datasette` for web-based viewing
- Runs on a daily schedule (12:13 UTC) via GitHub Actions to capture historical view count data

## Project Structure

```
.
â”œâ”€â”€ program.py              # Main script that fetches YouTube data and stores it in SQLite
â”œâ”€â”€ pyproject.toml          # Project metadata and dependencies
â”œâ”€â”€ requirements.txt        # Locked dependencies (generated by uv)
â”œâ”€â”€ views.db                # SQLite database containing historical view count data
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â””â”€â”€ update.yml      # GitHub Actions workflow (runs daily)
â”‚   â””â”€â”€ dependabot.yaml     # Dependabot configuration for dependency updates
```

## Common Commands

### Running the data collection script
```bash
python program.py
```
This fetches the latest video data from DjangoConUS and inserts it into `views.db`.

### Serving the data with datasette
```bash
datasette views.db
```
Starts a local web server (typically at http://localhost:8001) to browse and query the database.

### Managing dependencies
Dependencies are defined in `pyproject.toml` and compiled using `uv`:
```bash
uv pip compile pyproject.toml -o requirements.txt
```

After any changes to `pyproject.toml`, regenerate `requirements.txt` using this command.

### Installing dependencies locally
```bash
uv pip install -r requirements.txt
```

Alternatively, you can install directly from `pyproject.toml` using uv:
```bash
uv pip install -e .
```

## Architecture Notes

- **Python Requirement**: This project requires Python 3.12 or later (specified in `pyproject.toml`).
- **Single Entry Point**: `program.py` is the only Python module. It handles data fetching and database operations in one file.
- **Automated Scheduling**: The GitHub Actions workflow triggers daily at 12:13 UTC via cron, running `program.py` to capture view count snapshots.
- **SQLite Database**: `views.db` stores records with `view_count`, `title`, `url`, and a `date` timestamp (auto-populated with insertion time).
- **Web UI**: Datasette provides a browser-based interface to query and explore the historical view count data without writing SQL.
- **Modern Packaging**: Uses `pyproject.toml` for project metadata and dependency management following PEP 621 standards.

## Dependencies

- **yt-dlp**: Downloads video metadata from YouTube channels
- **datasette**: Provides a web UI for exploring SQLite databases
- Several transitive dependencies for HTTP, templating, and ASGI support

## Dependency Updates

Dependabot is configured to:
- Check for pip package updates weekly
- Check for GitHub Actions updates weekly
- Create PRs against `main` with commit prefix `pip prod` or `github-actions`
- Label PRs with `ğŸ› ï¸ maintenance`

Merge these PRs normallyâ€”they update `requirements.txt` and workflow dependencies.
